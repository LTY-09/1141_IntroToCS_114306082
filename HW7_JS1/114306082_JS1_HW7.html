<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulls and Cows Game</title>
</head>
<body>
    <h1>114306082_HW6_1A2B</h1>
    
    <input type="text" id="guessInput" maxlength="4" placeholder="Enter 4 digits">
    <button onclick="play()">Guess</button>
    
    <h3>Game Record:</h3>
    <div id="record"></div>

    <script>
        var answer = generateAnswer();
        var attemptCount = 0;
        var gameWon = false;

        function generateAnswer() {
            var digits = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
            var result = "";
            
            for (var i = 0; i < 4; i++) {
                var randomIndex = Math.floor(Math.random() * digits.length);
                result += digits[randomIndex];
                digits.splice(randomIndex, 1);
            }
            
            return result;
        }

        function play() {
            if (gameWon) {
                return;
            }

            var inputField = document.getElementById("guessInput");
            var guess = inputField.value;
            
            if (!isValid(guess)) {
                alert("Invalid input! Please enter exactly 4 unique digits.");
                return;
            }
            
            attemptCount++;
            var result = checkAB(guess, answer);
            
            var recordDiv = document.getElementById("record");
            recordDiv.innerHTML += "<p>第 " + attemptCount + "次: " + guess + " → " + result + "</p>";
            
            if (result === "4A0B") {
                alert("Congratulations! You guessed the correct number in " + attemptCount + " attempts!");
                gameWon = true;
            }
            
            inputField.value = "";
        }

        function isValid(str) {
            if (str.length !== 4) {
                return false;
            }
            
            for (var i = 0; i < str.length; i++) {
                if (isNaN(str[i])) {
                    return false;
                }
            }
            
            var digits = str.split("");
            for (var i = 0; i < digits.length; i++) {
                for (var j = i + 1; j < digits.length; j++) {
                    if (digits[i] === digits[j]) {
                        return false;
                    }
                }
            }
            
            return true;
        }

        function checkAB(guess, ans) {
            var a = 0;
            var b = 0;
            
            var guessArray = guess.split("");
            var ansArray = ans.split("");
            
            for (var i = 0; i < guessArray.length; i++) {
                if (guessArray[i] === ansArray[i]) {
                    a++;
                } else if (ansArray.indexOf(guessArray[i]) !== -1) {
                    b++;
                }
            }
            
            return a + "A" + b + "B";
        }
    </script>
</body>
</html>